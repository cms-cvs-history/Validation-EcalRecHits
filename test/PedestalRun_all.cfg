process EcalHitsValid  = 
	{
    untracked PSet maxEvents = {untracked int32 input = 10}

  # create empty events using a neutrino gun
  #
  source = FlatRandomEGunSource
  {
     untracked PSet PGunParameters =
     {
        # you can request more than 1 particle
        untracked vint32 PartID = {14}
        untracked double MinEta = -3.0
        untracked double MaxEta =  3.0
        untracked double MinPhi = -3.14159265358979323846 # in radians
        untracked double MaxPhi =  3.14159265358979323846
        untracked double MinE   =  9.99
        untracked double MaxE   = 10.01
     }
     untracked int32 Verbosity = 0 # set to 1 (or greater)  for printouts
  }
    
  # initialize  MessageLogger
  include "FWCore/MessageLogger/data/MessageLogger.cfi"   

  # initialize magnetic field
  include "Configuration/StandardSequences/data/MagneticField.cff"

  # geometry (Only Ecal)
  include "Geometry/EcalCommonData/data/EcalOnly.cfi"

  include "Geometry/CaloEventSetup/data/CaloGeometry.cff"

  include "Geometry/CaloEventSetup/data/EcalTrigTowerConstituents.cfi"

  include "Geometry/EcalMapping/data/EcalMapping.cfi"

  include "Geometry/EcalMapping/data/EcalMappingRecord.cfi"

  module USER = PoolOutputModule { 
         untracked string fileName = "PedestalRun_all_EcalValidation.root"      
  }
                                                                                
  # DQM services
  include "DQMServices/Core/data/DQM.cfg"
  replace DQM.collectorHost = ""

 service = RandomNumberGeneratorService
    {
        untracked uint32 sourceSeed = 98765
        PSet moduleSeeds =
        {
            untracked uint32 g4SimHits = 9876
            untracked uint32 simEcalUnsuppressedDigis = 12345
        }
    }
  module randomEngineStateProducer = RandomEngineStateProducer { }	

  service = Timing{ }
  
  service = SimpleMemoryCheck{ }

  include "SimGeneral/HepPDTESSource/data/pythiapdt.cfi"

  # run simulation, with EcalHits Validation specific watcher 
  include "SimG4Core/Application/data/g4SimHits.cfi"
  replace g4SimHits.Generator.HepMCProductLabel = "source"
  replace g4SimHits.Watchers = {
       { string type = "EcalSimHitsValidProducer"
         untracked string instanceLabel="EcalValidInfo"
         untracked bool verbose = false
       }
  }

  # ECAL hits validation sequence
  include "Validation/EcalHits/data/ecalSimHitsValidationSequence.cff"
		
  # Mixing Module
  include "SimGeneral/MixingModule/data/mixNoPU.cfi"

  include "CalibCalorimetry/Configuration/data/Ecal_FakeConditions.cff"

  # ECAL unsuppressed digis
  include "SimCalorimetry/EcalSimProducers/data/ecaldigi.cfi"	
  replace simEcalUnsuppressedDigis.EBdigiCollection = ebUnsuppDigis
  replace simEcalUnsuppressedDigis.EEdigiCollection = eeUnsuppDigis
  replace simEcalUnsuppressedDigis.ESdigiCollection = esUnsuppDigis

  # ECAL unsuppressed digis validation sequence
  include "Validation/EcalDigis/data/ecalDigisValidation.cfi"
  include "Validation/EcalDigis/data/ecalBarrelDigisValidation.cfi"
  include "Validation/EcalDigis/data/ecalEndcapDigisValidation.cfi"
  include "Validation/EcalDigis/data/ecalPreshowerDigisValidation.cfi"
  replace ecalDigisValidation.EBdigiCollection = simEcalUnsuppressedDigis:ebUnsuppDigis
  replace ecalDigisValidation.EEdigiCollection = simEcalUnsuppressedDigis:eeUnsuppDigis
  replace ecalDigisValidation.ESdigiCollection = simEcalUnsuppressedDigis:esUnsuppDigis
  replace ecalBarrelDigisValidation.EBdigiCollection = simEcalUnsuppressedDigis:ebUnsuppDigis
  replace ecalEndcapDigisValidation.EEdigiCollection = simEcalUnsuppressedDigis:eeUnsuppDigis
  replace ecalPreshowerDigisValidation.ESdigiCollection = simEcalUnsuppressedDigis:esUnsuppDigis

  # ECAL LocalReco sequence 
  include "CalibCalorimetry/EcalLaserCorrection/data/ecalLaserCorrectionService.cfi"
  include "RecoLocalCalo/EcalRecProducers/data/ecalWeightUncalibRecHit.cfi"
  replace ecalWeightUncalibRecHit.EBdigiCollection = simEcalUnsuppressedDigis:ebUnsuppDigis
  replace ecalWeightUncalibRecHit.EEdigiCollection = simEcalUnsuppressedDigis:eeUnsuppDigis
  include "RecoLocalCalo/EcalRecProducers/data/ecalRecHit.cfi"
  include "RecoLocalCalo/EcalRecProducers/data/ecalPreshowerRecHit.cfi"
  replace ecalPreshowerRecHit.ESdigiCollection = simEcalUnsuppressedDigis:esUnsuppDigis
  
  sequence ecalUnsuppressedLocalRecoSequence = { ecalWeightUncalibRecHit, ecalRecHit , ecalPreshowerRecHit }

  # ECAL rechits validation sequence
  include "Validation/EcalRecHits/data/ecalUnsuppressedRecHitsValidationSequence.cff"

  sequence simhits  = {g4SimHits , ecalSimHitsValidationSequence}
  sequence digis    = {mix , simEcalUnsuppressedDigis}
  sequence digisVal = {ecalDigisValidation, ecalBarrelDigisValidation, ecalEndcapDigisValidation, ecalPreshowerDigisValidation}
  sequence rechits = { ecalUnsuppressedLocalRecoSequence , ecalUnsuppressedRecHitsValidationSequence }

  path p1 = { simhits }
  path p2 = { digis } 
  path p3 = { digisVal } 
  path p4 = { rechits } 
  path p5 = { randomEngineStateProducer }
  endpath outpath = { USER }

  schedule = { p1, p2, p3, p4, p5, outpath }   

  }		
